{% extends "base.html" %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    {% block content %}

    <style>
        .ingredient-form {
            border-bottom: 1px solid black;
            }
        .hidden {
            display: none
            }
    </style>

<!--    {% if message %}-->

<!--        <p>{{ message }}</p>-->

<!--    {% endif %}-->

    <div style="margin-top:30px;">
        {% include 'recipes/partials/forms.html' %}

        <h3>Ingredients</h3>
        {% for ingredient in object.get_ingredients_children %}
            {% include 'recipes/partials/ingredient-inline.html' with object=ingredient %}
        {% endfor %}
        {% if create_ingredient_url %}
            <div id="ingredient-create">

            </div>

            <button hx-get="{{ create_ingredient_url }}" hx-trigger="click"
                        hx-target="#ingredient-create" hx-swap="beforeend">Add new ingredient</button>
        {% endif %}
    </div>


    <script>

        // const addMoreBtn = document.getElementById("add-more")


        document.addEventListener("click", (event)=>{
            if (event.target.id == "add-more") {
                add_new_form(event)
            }
            console.log(event.target, event.id)
        })
        // addMoreBtn.addEventListener("click", add_new_form)

        function add_new_form(event) {
            if (event) {
                event.preventDefault()
            }

            // now add new empty form

            const totalNewForms = document.getElementById("id_form-TOTAL_FORMS")
            const currentIngredientForms = document.getElementsByClassName("ingredient-form")
            let currentFormCount = currentIngredientForms.length

            const formCopyTarget = document.getElementById("ingredient-form-list")

            const copyEmptyFormEl = document.getElementById("empty-form").cloneNode(true)
            copyEmptyFormEl.setAttribute('class', 'ingredient-form')
            copyEmptyFormEl.setAttribute('id', `form-${currentFormCount}`)
            const regex = new RegExp('__prefix__', 'g')
            copyEmptyFormEl.innerHTML = copyEmptyFormEl.innerHTML.replace(regex, currentFormCount)
            totalNewForms.setAttribute('value', currentFormCount + 1)
            formCopyTarget.append(copyEmptyFormEl)
        }
    </script>


    {% endblock content %}
</body>
</html>